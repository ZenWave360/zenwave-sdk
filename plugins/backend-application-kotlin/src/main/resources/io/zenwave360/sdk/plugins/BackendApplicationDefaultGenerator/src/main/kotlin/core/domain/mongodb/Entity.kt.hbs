package {{layout.entitiesPackage}}

import java.io.Serializable
import java.math.*
import java.time.*
import java.util.*
import jakarta.validation.constraints.*
import org.springframework.data.annotation.Id
import org.springframework.data.annotation.Version
import org.springframework.data.mongodb.core.index.Indexed
import org.springframework.data.mongodb.core.mapping.DBRef
import org.springframework.data.mongodb.core.mapping.Document
import org.springframework.data.mongodb.core.mapping.DocumentReference
import org.springframework.data.mongodb.core.mapping.Field
{{~#if entity.options.auditing}}
import org.springframework.data.annotation.CreatedBy
import org.springframework.data.annotation.CreatedDate
import org.springframework.data.annotation.LastModifiedBy
import org.springframework.data.annotation.LastModifiedDate
{{/if}}

/**
* {{entity.comment}}
*/
{{#unless (skipEntityId entity)~}}@Document(collection = "{{entity.tableName}}"){{/unless~}}
data class {{entity.className}}(
{{#unless (skipEntityId entity)~}}
    @Id
    var id: {{idJavaType}}?,

    @Version
    var version: Int?,
{{/unless~}}

{{#each entity.fields as |field|}}
    {{~#if field.javadoc}}
    /**
    * {{{field.javadoc}}}
    */
    {{~/if}}
    {{fieldPersistenceAnnotations field}}
    {{{fieldValidationAnnotations field}}}
    var {{field.name}}: {{{fieldType field}}}? {{{fieldTypeInitializer field}}}{{#unless @last}},{{/unless}}
{{/each}}
) {{addExtends entity}} : Serializable {

    companion object {
        private const val serialVersionUID = 1L
    }

{{~#if entity.options.auditing}}
    @CreatedBy
    var createdBy: String? = null

    @CreatedDate
    var createdDate: LocalDateTime? = null

    @LastModifiedBy
    var lastModifiedBy: String? = null

    @LastModifiedDate
    var lastModifiedDate: LocalDateTime? = null
{{/if~}}

{{#each entity.fields as |field|}}
    {{~#if field.isArray}}
    fun add{{capitalize field.name}}({{field.name}}: {{javaType field}}): {{entity.className}} {
        this.{{field.name}} += {{field.name}}
        return this
    }
    {{~/if}}
{{/each}}

{{#unless (skipEntityId entity)~}}
    /* https://vladmihalcea.com/the-best-way-to-implement-equals-hashcode-and-tostring-with-jpa-and-hibernate/ */
    override fun equals(other: Any?): Boolean {
        if (this === other) return true
        if (other !is {{entity.className}}) return false
        return id != null && id == other.id
    }

    override fun hashCode(): Int {
        return javaClass.hashCode()
    }
{{~/unless}}
}
