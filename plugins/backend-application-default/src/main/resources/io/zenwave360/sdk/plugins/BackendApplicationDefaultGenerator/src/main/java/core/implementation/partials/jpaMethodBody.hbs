{{~#each entities as |entity|}}
    {{~#if (isCrudMethod 'create' method=method entity=entity )}}
        log.debug("Request to save {{entity.className}}: {}", input);
        var {{entity.instanceName}} = {{entity.instanceName}}Mapper.update(new {{entity.className}}(), input);
        {{entity.instanceName}} = {{entity.instanceName}}Repository.save({{entity.instanceName}});
        // TODO: you may need to reload the entity here to fetch all the relationships
        return {{entity.instanceName}};
    {{~else if (isCrudMethod 'update' method=method entity=entity )}}
        log.debug("Request to update {{entity.className}}: {}", input);
        var {{entity.instanceName}} = {{entity.instanceName}}Repository.findById(id);
        {{entity.instanceName}} = {{entity.instanceName}}.map(existing{{entity.instanceName}} -> {{entity.instanceName}}Mapper.update(existing{{entity.instanceName}}, input));
        // saving is unnecessary: https://vladmihalcea.com/best-spring-data-jparepository/
        return {{entity.instanceName}};
    {{~else if (isCrudMethod 'list' method=method entity=entity )}}
        log.debug("Request list of {{entity.classNamePlural}}: {}", pageable);
        return {{entity.instanceName}}Repository.findAll(pageable);
    {{~else if (isCrudMethod 'search' method=method entity=entity )}}
        log.debug("Request to search {{entity.classNamePlural}}: {} - {}", criteria, pageable);
        // TODO implement this search by criteria
        return {{entity.instanceName}}Repository.findAll(pageable);
    {{~else if (isCrudMethod 'get' method=method entity=entity )}}
        log.debug("Request to get {{entity.className}} : {}", id);
        return {{entity.instanceName}}Repository.findById(id);
    {{~else if (isCrudMethod 'delete' method=method entity=entity )}}
        log.debug("Request to delete {{entity.className}} : {}", id);
        {{entity.instanceName}}Repository.deleteById(id);
    {{~else~}}
    {{~/if}}
{{~/each}}
{{~#unless method.isCrudMethod}} {{!-- comes from helper isCrudMethod --}}
  {{~assign "entity" (methodEntity method service=service)}}
  {{~assign "returnEntity" (methodReturnEntity method service=service)}}
  {{~#if entity}}
      {{~#if method.paramId }}
        log.debug("Request {{method.name}}: {}", id);
        var {{entity.instanceName}} = {{entity.instanceName}}Repository.findById(id).orElseThrow();
        {{~#if method.parameter}}
        {{entity.instanceName}} = {{entity.instanceName}}Mapper.update({{entity.instanceName}}, input);
        {{~/if}}
      {{~else if method.parameter }}
        log.debug("Request {{method.name}}: {}", input);
        {{~#if (eq entity.name returnEntity.name)}}
        var {{entity.instanceName}} = {{entity.instanceName}}Mapper.update(new {{entity.className}}(), input);
        {{~/if}}
      {{~else}}
        log.debug("Request {{method.name}}");
        // var {{entity.instanceName}} = new {{entity.className}}();
      {{~/if}}
      // TODO: implement this method
      {{~#if method.returnType}}
        {{~#if (eq entity.name returnEntity.name)}}
        return {{entity.instanceName}}Repository.save({{entity.instanceName}});
        {{~else}}
        return {{entity.instanceName}};
        {{~else}}
        return null;
        {{~/if}}
      {{~/if}}
  {{~else~}}
        // TODO: implement this method
      {{~#if method.returnType}}
        return null;
      {{~/if}}
  {{~/if}}
{{~/unless}}
