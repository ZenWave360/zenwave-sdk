package {{layout.infrastructureRepositoryPackage}}

import {{layout.infrastructureRepositoryCommonPackage}}.BaseRepositoryIntegrationTest

import {{layout.entitiesPackage}}.*
import {{layout.outboundRepositoryPackage}}.{{entity.className}}Repository

import java.util.HashSet
import java.util.HashMap
import java.util.List
import java.time.*
import java.math.BigDecimal
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test
import org.springframework.beans.factory.annotation.Autowired

class {{entity.className}}RepositoryIntegrationTest : BaseRepositoryIntegrationTest() {

    @Autowired
    lateinit var {{entity.instanceName}}Repository: {{entity.className}}Repository

    @Test
    fun findAllTest() {
        val results = {{entity.instanceName}}Repository.findAll()
        Assertions.assertFalse(results.isEmpty())
    }

    @Test
    fun findByIdTest() {
        val id = "1"
        val {{entity.instanceName}} = {{entity.instanceName}}Repository.findById(id).orElseThrow()
        Assertions.assertNotNull({{entity.instanceName}}.id)
        Assertions.assertNotNull({{entity.instanceName}}.version)
        {{~#if (or entity.options.auditing entity.options.extendsAuditing)}}
        Assertions.assertNotNull({{entity.instanceName}}.createdDate)
        {{~/if}}
    }

    @Test
    fun saveTest() {
        val {{entity.instanceName}} = {{entity.className}}()
        {{~#each entity.fields as |field|}}
        // {{entity.instanceName}}.{{field.name}} = null
        {{~/each}}

        val created = {{entity.instanceName}}Repository.save({{entity.instanceName}})
        Assertions.assertNotNull(created.id)
        Assertions.assertNotNull(created.version)
        {{~#if (or entity.options.auditing entity.options.extendsAuditing)}}
        Assertions.assertNotNull(created.createdDate)
        {{~/if}}
    }

    @Test
    fun updateTest() {
        val id = "1"
        val {{entity.instanceName}} = {{entity.instanceName}}Repository.findById(id).orElseThrow()
        {{~#each entity.fields as |field|}}
        // {{entity.instanceName}}.{{field.name}} = null
        {{~/each}}

        val updated = {{entity.instanceName}}Repository.save({{entity.instanceName}})
        {{~#each entity.fields as |field|}}
        Assertions.assertEquals(null, updated.{{field.name}})
        {{~/each}}
    }

    @Test
    fun deleteTest() {
        val id = "1"
        {{entity.instanceName}}Repository.deleteById(id)
        val notFound = {{entity.instanceName}}Repository.findById(id)
        Assertions.assertFalse(notFound.isPresent)
    }
}
