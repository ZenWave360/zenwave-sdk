{{~#each entities as |entity|}}
    {{~#if (isCrudMethod 'create' method=method entity=entity )}}
        log.debug("Request to save {{entity.className}}: {}", input);
        var {{entity.instanceName}} = {{entity.instanceName}}Mapper.update(new {{entity.className}}(), input);
        {{entity.instanceName}} = {{entity.instanceName}}Repository.save({{entity.instanceName}});
        // TODO: you may need to reload the entity here to fetch all the relationships
        return {{entity.instanceName}};
    {{~/if}}
    {{~#if (isCrudMethod 'update' method=method entity=entity )}}
        log.debug("Request to update {{entity.className}}: {}", input);
        var {{entity.instanceName}} = {{entity.instanceName}}Repository.findById(id);
        {{entity.instanceName}} = {{entity.instanceName}}.map(existing{{entity.instanceName}} -> {{entity.instanceName}}Mapper.update(existing{{entity.instanceName}}, input));
        // saving is unnecessary: https://vladmihalcea.com/best-spring-data-jparepository/
        return {{entity.instanceName}};
    {{~/if}}
    {{~#if (isCrudMethod 'list' method=method entity=entity )}}
        log.debug("Request list of {{entity.classNamePlural}}: {}", pageable);
        return {{entity.instanceName}}Repository.findAll(pageable);
    {{~/if}}
    {{~#if (isCrudMethod 'search' method=method entity=entity )}}
        log.debug("Request to search {{entity.classNamePlural}}: {} - {}", criteria, pageable);
        // TODO implement this search by criteria
        return {{entity.instanceName}}Repository.findAll(pageable);
    {{~/if}}
    {{~#if (isCrudMethod 'get' method=method entity=entity )}}
        log.debug("Request to get {{entity.className}} : {}", id);
        return {{entity.instanceName}}Repository.findById(id);
    {{~/if}}
    {{~#if (isCrudMethod 'delete' method=method entity=entity )}}
        log.debug("Request to delete {{entity.className}} : {}", id);
        {{entity.instanceName}}Repository.deleteById(id);
    {{~/if}}
{{~/each}}
